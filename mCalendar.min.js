/**
 * LBS mCalendar 
 * Date: 2015-8-20 
 **/
!function(a,b){"use strict";var c=function(){function a(a,b,c){for(var d=0,e=b.length;e>d;d++)a.addEventListener(b[d],c,!1)}function c(a){return b.createElement(a)}function d(a){return parseInt(a)<10?"0"+a:a}return{create:c,on:a,format:d}}();a.mCalendar=function(){this._init.apply(this,arguments)},mCalendar.prototype={_init:function(a){a=a||{},this.parent=a.parent||b.getElementsByTagName("body")[0],this.count=a.count||1,this.year=parseInt(a.year)||(new Date).getFullYear(),this.month=parseInt(a.month)||(new Date).getMonth()+1,this.today=(new Date).getFullYear()+"-"+c.format((new Date).getMonth()+1)+"-"+c.format((new Date).getDate()),this.selected="1800-01-01",this.select=a.select||function(){},this.input=a.input},_create:function(){return this.box||(this.exist=!0,this.box=c.create("div"),this.box.className="M_calendar",this.prev=c.create("a"),this.prev.className="M_prev",this.prev.href="javascript:;",this.prev.innerHTML="&lt;",this.box.appendChild(this.prev),this.next=c.create("a"),this.next.className="M_next",this.next.href="javascript:;",this.next.innerHTML="&gt;",this.box.appendChild(this.next),this.content=c.create("div"),this.content.className="M_content",this._draw(),this.box.appendChild(this.content),this.parent.appendChild(this.box),this._bind()),this},_draw:function(){for(var a=0;a<this.count;a++)this.month=this.month+(a?1:0),this.month>12&&(this.year++,this.month-=12),this.month<1&&(this.year--,this.month+=12),this.content.appendChild(this._drawMonth(this.year,this.month));return this},_drawWeek:function(){for(var a=b.createDocumentFragment(),d="日一二三四五六".split(""),e=null,f=0,g=d.length;g>f;f++)e=c.create("span"),e.innerHTML=d[f],a.appendChild(e);return a},_darwDay:function(a,d){var e=b.createDocumentFragment(),f=new Date(a,d-1,1).getDay(),g=new Date(a,d,0).getDate(),h=[],i=null,j=0,k=0,l=parseInt(this.today.replace(/-/g,"")),m=parseInt(this.selected.replace(/-/g,"")),n=l,o=f+g;for(k=0;f>k;k++)h.push(0);for(k=1;g>=k;k++)h.push(k);for(k=0;o>k;k++)i=c.create("a"),i.href="javascript:;",j=h.shift(),j?(i.date=a+"-"+c.format(d)+"-"+c.format(j),i.innerHTML=j,i.className="day_date",n=i.date.replace(/-/g,""),n==l&&(i.className+=" day_today"),n==m&&(i.className+=" day_selected")):(i.innerHTML="&nbsp;",i.className="day_disabled"),e.appendChild(i);return e},_drawMonth:function(a,b){var d=c.create("dl"),e=c.create("dt"),f=c.create("dd"),g=c.create("div"),h=c.create("div");return d.className="M_dl",e.className="M_dt",f.className="M_dd",g.className="M_time",h.className="M_week",g.innerHTML=a+"年"+b+"月",e.appendChild(g),h.appendChild(this._drawWeek()),e.appendChild(h),f.appendChild(this._darwDay(a,b)),d.appendChild(e),d.appendChild(f),d},_nextMonth:function(){return this.month++,this.draw(),this},_prevMonth:function(){return this.month-=2*this.count-1,this.draw(),this},_bind:function(){var a=this,d=null;c.on(this.box,["click"],function(b){b.stopPropagation(),a.status&&(d=b.target,"A"===d.tagName.toUpperCase()&&d.className.indexOf("M_prev")>-1&&a._prevMonth(),"A"===d.tagName.toUpperCase()&&d.className.indexOf("M_next")>-1&&a._nextMonth(),"A"===d.tagName.toUpperCase()&&d.className.indexOf("day_date")>-1&&(a.hide(),a.selected=d.date,a.select&&a.select(d.date)))}),c.on(this.box,["touchend","pointerup","MSPointerUp"],function(a){a.stopPropagation()}),c.on(b,["touchend","pointerup","MSPointerUp"],function(b){a.status&&a.input&&b.target!==a.input&&a.hide()})},draw:function(){return this.exist?(this.content.innerHTML="",this._draw(),this):this._create()},show:function(){return this.status=!0,this.exist||this._create(),this.box.style.display="block",this},hide:function(){return this.status=!1,this.box.style.display="none",this}}}(window,document);